主要对网站或者App的业务流量进行识别、防护，对流量进行清洗之后，将正常、安全的流量返回给服务器。

WAF当前仅支持通过域名方式接入WAF，不支持通过IP。

# 功能特性

| 功能类别          | 功能说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **业务配置**      | 支持对网站的**HTTP、HTTPS**流量进行安全防护。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Web应用安全防护** | 1. **常见Web应用攻击防护**<br>• **防御OWASP常见威胁**：**SQL注入、XSS跨站、WebShell上传、后门攻击、命令注入、非法HTTP协议请求、常见Web服务器漏洞攻击、核心文件非授权访问、路径穿越、网站被扫描等**。<br>• 网站隐身：不对攻击者暴露站点地址，避免其绕过Web应用防火墙直接攻击。<br>• 0day补丁及时更新：及时更新漏洞补丁，防护网站安全。<br>• 友好的观察模式：针对网站新上线的业务开启观察模式，对于匹配中防护规则的疑似攻击只告警不阻断，方便统计业务误报状况。<br><br>2. **深度精确防护**<br>• 支持全解析多种常见HTTP协议数据格式：**任意头部字段、Form表单、Multipart、JSON、XML。**<br>• 支持解码常见编码类型：URL编码、Java Script Unicode编码、HEX编码、HTML实体编码、Java序列化编码、PHP序列化编码、Base64编码、UTF-7编码、UTF-8编码、混合嵌套编码。<br>• 支持预处理机制：空格压缩、注释删减、特殊字符处理，向上层多种检测引擎提供更为精细、准确的数据源。<br>• 支持复杂格式数据环境下的检测能力；支持合理的检测逻辑复杂度，避免过多检测数据导致的误报，降低误报率；支持多种形式数据编码的自适应解码，避免利用各种编码形式的绕过。<br><br>3. **CC恶意攻击防护**<br>• **控制单一源IP的访问频率，基于重定向跳转验证、人机识别等。**<br>• 针对海量慢速请求攻击，根据统计响应码及URL请求分布、异常Referer及User-Agent特征识别，结合网站精准防护规则综合防护。<br>• 抵御CC攻击和网络爬虫<br>• **充分利用阿里云大数据安全优势，建立威胁情报与可信访问分析模型，快速识别恶意流量。**<br><br>4. **精准访问控制**<br>• 提供友好的配置控制台界面，支持IP、URL、Referer、User-Agent等HTTP常见字段的条件组合，配置强大的精准访问控制策略；支持盗链防护、网站后台保护等防护场景。<br>• 与Web常见攻击防护、CC防护等安全模块结合，搭建多层综合保护机制；依据需求，轻松识别可信与恶意流量。<br><br>5. **虚拟补丁**<br>在**Web应用漏洞补丁发布和修复之前，通过调整Web防护策略实现快速防护。** |
| **攻击事件管理**    | 支持对攻击事件、攻击流量、攻击规模的集中管理统计。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **灵活性、可靠性**   | • 支持负载均衡：以集群方式提供服务，多台服务器负载均衡，支持多种负载均衡策略。<br>• 支持平滑扩容：可根据实际流量情况，缩减或增加集群服务器的数量，实现服务能力弹性扩容。<br>• 无单点问题：单台服务器宕机或者维修，均不影响正常服务。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
# WAF 3.0与2.0
3.0是最新推出的版本，在接入方式、防护配置、计费方式等方面进行了优化。两者不能在同一账号下共存，各自有单独的控制台。

## 接入方式对比
WAF支持云产品接入、CNAME接入。
其中，3.0支持更先进的云产品SDK接入

| 接入方式                                | WAF 3.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | WAF 2.0 |
| :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------ |
| **CNAME接入**<br>（图示①）                | 支持。<br>• 通过添加域名，将域名的DNS解析指向WAF的CNAME地址，使域名的Web业务引流到WAF。WAF会拦截攻击请求并将正常业务请求转发回源站服务器。<br>• 该过程中，WAF作为反向代理集群，同时参与流量的转发和检测防护。                                                                                                                                                                                                                                                                                                                                                                  | 支持。     |
| **云产品接入**<br>（WAF作为反向代理集群）<br>（图示②） | 支持。<br>• 通过添加引流端口到WAF的方式，使云产品网关自动改变路由，**将Web业务引流到WAF**。**WAF会拦截攻击请求并将正常业务请求转发回源站服务器**。<br>• 该过程中，WAF作为反向代理集群，同时参与流量的转发和检测防护。                                                                                                                                                                                                                                                                                                                                                              | 支持。     |
| **云产品接入**<br>（WAF作为SDK插件）<br>（图示③）  | 支持。<br>如果您的业务已在应用型负载均衡ALB（Application Load Balancer）、微服务引擎MSE（Microservices Engine）或函数计算（FunctionCompute，简称FC）运行，推荐您使用该种接入方式接入WAF。<br>• WAF 3.0通过SDK模块化的方式集成在云产品的网关中，通过**内嵌在网关中的SDK提取流量并进行检测和防护**。该过程中，WAF不参与流量转发，避免因额外引入一层转发而带来各种兼容性和稳定性问题。<br>• **支持基于实例一键开启安全防护，无需修改DNS，也无需配置证书、端口、回源算法等**，简化接入流程，降低对原有业务的影响。<br>• **支持阿里云原生产品实例支持的所有地域，覆盖更广**。<br>• 支持在多云或混合云本地自建网关（如Nginx），通过混合云SDK服务化接入方式集成。<br>• 基于服务化接入，WAF 3.0补充完整了各种业务场景下的灵活接入能力，可基于用户的实际网络环境和合规等需求，支持多种环境下的接入部署，并实现由一套控制台统一管控。 | 不支持。    |
## 2.0的CNAME接入和透明接入

| 差异              | CNAME接入                                                 | 透明接入                                                                                                                          |
| :-------------- | :------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------------------------- |
| **概念**          | 通过将需要防护的网站信息添加到WAF，并修改网站域名的DNS解析设置，将源站的Web请求转发到WAF进行防护。 | 通过将需要防护的网站信息添加到WAF，无需修改域名的DNS解析设置，即可将源站的Web请求转发到WAF进行防护。                                                                      |
| **支持的源站**       | 部署在阿里云上或云下的所有源站。                                        | 部署在ECS服务器或阿里云公网SLB上。                                                                                                          |
| **接入域名维度**      | 一次只能接入一个域名。                                             | 可以按实例维度接入该实例下的所有域名。                                                                                                           |
| **是否需要设置回源**    | 需要设置回源。                                                 | 无需设置回源。                                                                                                                       |
| **是否需要修改DNS解析** | 需要修改DNS解析。                                              | 无需修改DNS解析。                                                                                                                    |
| **是否需要设置源站保护**  | 源站存在直接被攻击的风险，需要设置源站保护。                                  | 无需设置源站保护。                                                                                                                     |
| **使用限制**        | 无。                                                      | • 由于网络底层架构限制，仅部分地区支持透明接入。<br>• 透明接入不支持私网SLB实例。<br>• 透明接入不支持IPv6，引流端口配置的数量也存在一定限制。<br>• 透明接入存在默认防护且无法修改，必须要配置域名后才能编辑域名级别的防护规则。 |
## 防护配置对比

|防护配置|WAF 3.0|WAF 2.0|
|:--|:--|:--|
|**批量配置防护规则**|**支持。**<br><br>WAF 3.0以接入的域名或实例为防护对象，并支持将防护对象加入到防护对象组。<br>• 您可以为防护对象组配置同一条防护规则，为防护对象组中的防护对象批量配置规则。<br>• 您也可以将云产品接入WAF的实例中的某一域名单独添加为防护对象，为其配置定制化的防护规则。|**不支持。**<br><br>WAF 2.0以域名为防护对象，仅支持为单条域名配置防护规则。若需要对100个域名下发一条相同规则时，必须配置100遍。|
|**为非域名接入的流量（如透明接入的实例）配置防护规则**|**支持。**<br><br>云产品接入的实例自动被添加为防护对象，并支持为其配置和修改防护规则。|**不支持。**<br><br>若透明接入的实例中包含100个域名时，必须将每个域名都接入WAF后，才可以调整规则，否则所有流量都只能使用默认防护规则且无法修改。|
|**全局查看防护规则**|**支持。**<br><br>WAF 3.0为每个防护模块规划卡片区域，您可以在每个模块区域查看和管理规则，轻松了解某个防护模块具体配置了哪些防护模板，这些防护模板各自关联了哪些防护对象或防护对象组。您还可以通过规则ID，检索防护规则。|**不支持。**<br><br>若您希望知道某个域名配置了哪些防护规则，需要查看所有防护规则。|
|**修改默认防护规则**|**支持。**<br><br>WAF 3.0中的防护规则模板具备默认属性。若您希望新接入的域名配置的默认防护规则均为观察模式，您可以将默认模板设置为观察模式，那么，新接入的防护对象的防护动作都为观察模式，无需每次手动修改。|**不支持。**<br><br>若您希望新接入的域名配置的默认防护规则均为观察模式，WAF 2.0是无法做到的。您需要在接入以后，手动修改对应域名的防护规则。|
## 计费
3.0版本支持包年包月和按量计费，两者并不能互相转换： https://help.aliyun.com/zh/waf/web-application-firewall-3-0/product-overview/editions

